#include <stdio.h>
#include <string.h>
#include <stdint.h>

typedef uint64_t Bitboard;

const Bitboard ROOK_MOVES[65][4] = { // South, West, North, East
    {0x0ULL, 0xfeULL, 0x101010101010100ULL, 0x0ULL},
    {0x0ULL, 0xfcULL, 0x202020202020200ULL, 0x1ULL},
    {0x0ULL, 0xf8ULL, 0x404040404040400ULL, 0x3ULL},
    {0x0ULL, 0xf0ULL, 0x808080808080800ULL, 0x7ULL},
    {0x0ULL, 0xe0ULL, 0x1010101010101000ULL, 0xfULL},
    {0x0ULL, 0xc0ULL, 0x2020202020202000ULL, 0x1fULL},
    {0x0ULL, 0x80ULL, 0x4040404040404000ULL, 0x3fULL},
    {0x0ULL, 0x0ULL, 0x8080808080808000ULL, 0x7fULL},
    {0x1ULL, 0xfe00ULL, 0x101010101010000ULL, 0x0ULL},
    {0x2ULL, 0xfc00ULL, 0x202020202020000ULL, 0x100ULL},
    {0x4ULL, 0xf800ULL, 0x404040404040000ULL, 0x300ULL},
    {0x8ULL, 0xf000ULL, 0x808080808080000ULL, 0x700ULL},
    {0x10ULL, 0xe000ULL, 0x1010101010100000ULL, 0xf00ULL},
    {0x20ULL, 0xc000ULL, 0x2020202020200000ULL, 0x1f00ULL},
    {0x40ULL, 0x8000ULL, 0x4040404040400000ULL, 0x3f00ULL},
    {0x80ULL, 0x0ULL, 0x8080808080800000ULL, 0x7f00ULL},
    {0x101ULL, 0xfe0000ULL, 0x101010101000000ULL, 0x0ULL},
    {0x202ULL, 0xfc0000ULL, 0x202020202000000ULL, 0x10000ULL},
    {0x404ULL, 0xf80000ULL, 0x404040404000000ULL, 0x30000ULL},
    {0x808ULL, 0xf00000ULL, 0x808080808000000ULL, 0x70000ULL},
    {0x1010ULL, 0xe00000ULL, 0x1010101010000000ULL, 0xf0000ULL},
    {0x2020ULL, 0xc00000ULL, 0x2020202020000000ULL, 0x1f0000ULL},
    {0x4040ULL, 0x800000ULL, 0x4040404040000000ULL, 0x3f0000ULL},
    {0x8080ULL, 0x0ULL, 0x8080808080000000ULL, 0x7f0000ULL},
    {0x10101ULL, 0xfe000000ULL, 0x101010100000000ULL, 0x0ULL},
    {0x20202ULL, 0xfc000000ULL, 0x202020200000000ULL, 0x1000000ULL},
    {0x40404ULL, 0xf8000000ULL, 0x404040400000000ULL, 0x3000000ULL},
    {0x80808ULL, 0xf0000000ULL, 0x808080800000000ULL, 0x7000000ULL},
    {0x101010ULL, 0xe0000000ULL, 0x1010101000000000ULL, 0xf000000ULL},
    {0x202020ULL, 0xc0000000ULL, 0x2020202000000000ULL, 0x1f000000ULL},
    {0x404040ULL, 0x80000000ULL, 0x4040404000000000ULL, 0x3f000000ULL},
    {0x808080ULL, 0x0ULL, 0x8080808000000000ULL, 0x7f000000ULL},
    {0x1010101ULL, 0xfe00000000ULL, 0x101010000000000ULL, 0x0ULL},
    {0x2020202ULL, 0xfc00000000ULL, 0x202020000000000ULL, 0x100000000ULL},
    {0x4040404ULL, 0xf800000000ULL, 0x404040000000000ULL, 0x300000000ULL},
    {0x8080808ULL, 0xf000000000ULL, 0x808080000000000ULL, 0x700000000ULL},
    {0x10101010ULL, 0xe000000000ULL, 0x1010100000000000ULL, 0xf00000000ULL},
    {0x20202020ULL, 0xc000000000ULL, 0x2020200000000000ULL, 0x1f00000000ULL},
    {0x40404040ULL, 0x8000000000ULL, 0x4040400000000000ULL, 0x3f00000000ULL},
    {0x80808080ULL, 0x0ULL, 0x8080800000000000ULL, 0x7f00000000ULL},
    {0x101010101ULL, 0xfe0000000000ULL, 0x101000000000000ULL, 0x0ULL},
    {0x202020202ULL, 0xfc0000000000ULL, 0x202000000000000ULL, 0x10000000000ULL},
    {0x404040404ULL, 0xf80000000000ULL, 0x404000000000000ULL, 0x30000000000ULL},
    {0x808080808ULL, 0xf00000000000ULL, 0x808000000000000ULL, 0x70000000000ULL},
    {0x1010101010ULL, 0xe00000000000ULL, 0x1010000000000000ULL, 0xf0000000000ULL},
    {0x2020202020ULL, 0xc00000000000ULL, 0x2020000000000000ULL, 0x1f0000000000ULL},
    {0x4040404040ULL, 0x800000000000ULL, 0x4040000000000000ULL, 0x3f0000000000ULL},
    {0x8080808080ULL, 0x0ULL, 0x8080000000000000ULL, 0x7f0000000000ULL},
    {0x10101010101ULL, 0xfe000000000000ULL, 0x100000000000000ULL, 0x0ULL},
    {0x20202020202ULL, 0xfc000000000000ULL, 0x200000000000000ULL, 0x1000000000000ULL},
    {0x40404040404ULL, 0xf8000000000000ULL, 0x400000000000000ULL, 0x3000000000000ULL},
    {0x80808080808ULL, 0xf0000000000000ULL, 0x800000000000000ULL, 0x7000000000000ULL},
    {0x101010101010ULL, 0xe0000000000000ULL, 0x1000000000000000ULL, 0xf000000000000ULL},
    {0x202020202020ULL, 0xc0000000000000ULL, 0x2000000000000000ULL, 0x1f000000000000ULL},
    {0x404040404040ULL, 0x80000000000000ULL, 0x4000000000000000ULL, 0x3f000000000000ULL},
    {0x808080808080ULL, 0x0ULL, 0x8000000000000000ULL, 0x7f000000000000ULL},
    {0x1010101010101ULL, 0xfe00000000000000ULL, 0x0ULL, 0x0ULL},
    {0x2020202020202ULL, 0xfc00000000000000ULL, 0x0ULL, 0x100000000000000ULL},
    {0x4040404040404ULL, 0xf800000000000000ULL, 0x0ULL, 0x300000000000000ULL},
    {0x8080808080808ULL, 0xf000000000000000ULL, 0x0ULL, 0x700000000000000ULL},
    {0x10101010101010ULL, 0xe000000000000000ULL, 0x0ULL, 0xf00000000000000ULL},
    {0x20202020202020ULL, 0xc000000000000000ULL, 0x0ULL, 0x1f00000000000000ULL},
    {0x40404040404040ULL, 0x8000000000000000ULL, 0x0ULL, 0x3f00000000000000ULL},
    {0x80808080808080ULL, 0x0ULL, 0x0ULL, 0x7f00000000000000ULL},
    {0x0ULL, 0x0ULL, 0x0ULL, 0x0ULL}
};

const Bitboard BISHOP_MOVES[65][4] = { // South East, South West, North West, North East
    {0x0ULL, 0x0ULL, 0x8040201008040200ULL, 0x0ULL},
    {0x0ULL, 0x0ULL, 0x80402010080400ULL, 0x100ULL},
    {0x0ULL, 0x0ULL, 0x804020100800ULL, 0x10200ULL},
    {0x0ULL, 0x0ULL, 0x8040201000ULL, 0x1020400ULL},
    {0x0ULL, 0x0ULL, 0x80402000ULL, 0x102040800ULL},
    {0x0ULL, 0x0ULL, 0x804000ULL, 0x10204081000ULL},
    {0x0ULL, 0x0ULL, 0x8000ULL, 0x1020408102000ULL},
    {0x0ULL, 0x0ULL, 0x0ULL, 0x102040810204000ULL},
    {0x0ULL, 0x2ULL, 0x4020100804020000ULL, 0x0ULL},
    {0x1ULL, 0x4ULL, 0x8040201008040000ULL, 0x10000ULL},
    {0x2ULL, 0x8ULL, 0x80402010080000ULL, 0x1020000ULL},
    {0x4ULL, 0x10ULL, 0x804020100000ULL, 0x102040000ULL},
    {0x8ULL, 0x20ULL, 0x8040200000ULL, 0x10204080000ULL},
    {0x10ULL, 0x40ULL, 0x80400000ULL, 0x1020408100000ULL},
    {0x20ULL, 0x80ULL, 0x800000ULL, 0x102040810200000ULL},
    {0x40ULL, 0x0ULL, 0x0ULL, 0x204081020400000ULL},
    {0x0ULL, 0x204ULL, 0x2010080402000000ULL, 0x0ULL},
    {0x100ULL, 0x408ULL, 0x4020100804000000ULL, 0x1000000ULL},
    {0x201ULL, 0x810ULL, 0x8040201008000000ULL, 0x102000000ULL},
    {0x402ULL, 0x1020ULL, 0x80402010000000ULL, 0x10204000000ULL},
    {0x804ULL, 0x2040ULL, 0x804020000000ULL, 0x1020408000000ULL},
    {0x1008ULL, 0x4080ULL, 0x8040000000ULL, 0x102040810000000ULL},
    {0x2010ULL, 0x8000ULL, 0x80000000ULL, 0x204081020000000ULL},
    {0x4020ULL, 0x0ULL, 0x0ULL, 0x408102040000000ULL},
    {0x0ULL, 0x20408ULL, 0x1008040200000000ULL, 0x0ULL},
    {0x10000ULL, 0x40810ULL, 0x2010080400000000ULL, 0x100000000ULL},
    {0x20100ULL, 0x81020ULL, 0x4020100800000000ULL, 0x10200000000ULL},
    {0x40201ULL, 0x102040ULL, 0x8040201000000000ULL, 0x1020400000000ULL},
    {0x80402ULL, 0x204080ULL, 0x80402000000000ULL, 0x102040800000000ULL},
    {0x100804ULL, 0x408000ULL, 0x804000000000ULL, 0x204081000000000ULL},
    {0x201008ULL, 0x800000ULL, 0x8000000000ULL, 0x408102000000000ULL},
    {0x402010ULL, 0x0ULL, 0x0ULL, 0x810204000000000ULL},
    {0x0ULL, 0x2040810ULL, 0x804020000000000ULL, 0x0ULL},
    {0x1000000ULL, 0x4081020ULL, 0x1008040000000000ULL, 0x10000000000ULL},
    {0x2010000ULL, 0x8102040ULL, 0x2010080000000000ULL, 0x1020000000000ULL},
    {0x4020100ULL, 0x10204080ULL, 0x4020100000000000ULL, 0x102040000000000ULL},
    {0x8040201ULL, 0x20408000ULL, 0x8040200000000000ULL, 0x204080000000000ULL},
    {0x10080402ULL, 0x40800000ULL, 0x80400000000000ULL, 0x408100000000000ULL},
    {0x20100804ULL, 0x80000000ULL, 0x800000000000ULL, 0x810200000000000ULL},
    {0x40201008ULL, 0x0ULL, 0x0ULL, 0x1020400000000000ULL},
    {0x0ULL, 0x204081020ULL, 0x402000000000000ULL, 0x0ULL},
    {0x100000000ULL, 0x408102040ULL, 0x804000000000000ULL, 0x1000000000000ULL},
    {0x201000000ULL, 0x810204080ULL, 0x1008000000000000ULL, 0x102000000000000ULL},
    {0x402010000ULL, 0x1020408000ULL, 0x2010000000000000ULL, 0x204000000000000ULL},
    {0x804020100ULL, 0x2040800000ULL, 0x4020000000000000ULL, 0x408000000000000ULL},
    {0x1008040201ULL, 0x4080000000ULL, 0x8040000000000000ULL, 0x810000000000000ULL},
    {0x2010080402ULL, 0x8000000000ULL, 0x80000000000000ULL, 0x1020000000000000ULL},
    {0x4020100804ULL, 0x0ULL, 0x0ULL, 0x2040000000000000ULL},
    {0x0ULL, 0x20408102040ULL, 0x200000000000000ULL, 0x0ULL},
    {0x10000000000ULL, 0x40810204080ULL, 0x400000000000000ULL, 0x100000000000000ULL},
    {0x20100000000ULL, 0x81020408000ULL, 0x800000000000000ULL, 0x200000000000000ULL},
    {0x40201000000ULL, 0x102040800000ULL, 0x1000000000000000ULL, 0x400000000000000ULL},
    {0x80402010000ULL, 0x204080000000ULL, 0x2000000000000000ULL, 0x800000000000000ULL},
    {0x100804020100ULL, 0x408000000000ULL, 0x4000000000000000ULL, 0x1000000000000000ULL},
    {0x201008040201ULL, 0x800000000000ULL, 0x8000000000000000ULL, 0x2000000000000000ULL},
    {0x402010080402ULL, 0x0ULL, 0x0ULL, 0x4000000000000000ULL},
    {0x0ULL, 0x2040810204080ULL, 0x0ULL, 0x0ULL},
    {0x1000000000000ULL, 0x4081020408000ULL, 0x0ULL, 0x0ULL},
    {0x2010000000000ULL, 0x8102040800000ULL, 0x0ULL, 0x0ULL},
    {0x4020100000000ULL, 0x10204080000000ULL, 0x0ULL, 0x0ULL},
    {0x8040201000000ULL, 0x20408000000000ULL, 0x0ULL, 0x0ULL},
    {0x10080402010000ULL, 0x40800000000000ULL, 0x0ULL, 0x0ULL},
    {0x20100804020100ULL, 0x80000000000000ULL, 0x0ULL, 0x0ULL},
    {0x40201008040201ULL, 0x0ULL, 0x0ULL, 0x0ULL},
    {0x0ULL, 0x0ULL, 0x0ULL, 0x0ULL}
};


#define RANK1 0b0000000000000000000000000000000000000000000000000000000011111111ULL
#define RANK2 0b0000000000000000000000000000000000000000000000001111111100000000ULL
#define RANK3 0b0000000000000000000000000000000000000000111111110000000000000000ULL
#define RANK4 0b0000000000000000000000000000000011111111000000000000000000000000ULL
#define RANK5 0b0000000000000000000000001111111100000000000000000000000000000000ULL
#define RANK6 0b0000000000000000111111110000000000000000000000000000000000000000ULL
#define RANK7 0b0000000011111111000000000000000000000000000000000000000000000000ULL
#define RANK8 0b1111111100000000000000000000000000000000000000000000000000000000ULL

#define FILEA 0b1000000010000000100000001000000010000000100000001000000010000000ULL
#define FILEB 0b0100000001000000010000000100000001000000010000000100000001000000ULL
#define FILEC 0b0010000000100000001000000010000000100000001000000010000000100000ULL
#define FILED 0b0001000000010000000100000001000000010000000100000001000000010000ULL
#define FILEE 0b0000100000001000000010000000100000001000000010000000100000001000ULL
#define FILEF 0b0000010000000100000001000000010000000100000001000000010000000100ULL
#define FILEG 0b0000001000000010000000100000001000000010000000100000001000000010ULL
#define FILEH 0b0000000100000001000000010000000100000001000000010000000100000001ULL

int main()
{
    int x = 6;

    Bitboard perimeter = RANK1 | RANK8 | FILEA | FILEH;
    printf("Perimeter: %llu\n", BISHOP_MOVES[25][0] | BISHOP_MOVES[25][1] | BISHOP_MOVES[25][2] | BISHOP_MOVES[25][3]);
    for (int i = 0; i < 64; i++) {
        Bitboard s = ROOK_MOVES[i][0] & ~RANK1;
        Bitboard w = ROOK_MOVES[i][1] & ~FILEA;
        Bitboard n = ROOK_MOVES[i][2] & ~RANK8;
        Bitboard e = ROOK_MOVES[i][3] & ~FILEH;
        Bitboard bishop_mask = s | w | n | e;
        printf(" 0x%llxULL,", bishop_mask);
        if (i % 4 == 3) {
            printf("\n");
        }
    }

    // if (x > 2) return;
    // FILE* file = fopen("fens.txt", "r");
    // FILE* boards = fopen("board.txt", "w");
    // FILE* moves = fopen("moves.txt", "w");
    // char line[1024];

    // Board board;

    // int i = 0;

    // while (fgets(line, sizeof(line), file)) {
    //     if (i % 2 == 0) {
    //         board_from_fen(&board, line);
    //         fprintf(boards, "%lluULL,\n", hash(&board));
    //     } else {
    //         int file1 = line[0] - 'a';
    //         int rank1 = line[1] - '1';
    //         int file2 = line[2] - 'a';
    //         int rank2 = line[3] - '1';
    //         int src = rank1 * 8 + (7 - file1);
    //         int dst = rank2 * 8 + (7 - file2);
    //         uint16_t flags = 0;
    //         int abs = __builtin_abs(src - dst);
    //         if (board.positions[src] == PAWN && abs == 16) {
    //             flags |= PAWN_DOUBLE;
    //         }
    //         if (board.positions[dst] != 0) {
    //             flags |= CAPTURE;
    //         }
    //         if (board.positions[src] == KING && abs == 2) {
    //             if (src - dst < 0) flags |= CASTLE_QUEENSIDE;
    //             if (src - dst > 0) flags |= CASTLE_KINGSIDE;
    //         }
    //         if (board.positions[src] == PAWN && (abs == 7 || abs == 9) && board.positions[dst] == 0) {
    //             flags |= EN_PASSANT;
    //         }
    //         switch (line[4]) {
    //             case 'n': flags |= ADD_PROMOTED_PIECE(KNIGHT); break;
    //             case 'b': flags |= ADD_PROMOTED_PIECE(BISHOP); break;
    //             case 'r': flags |= ADD_PROMOTED_PIECE(ROOK); break;
    //             case 'q': flags |= ADD_PROMOTED_PIECE(QUEEN); break;
    //         }
    //         fprintf(moves, "{%d, %d, 0x%0x},\n", dst, src, flags);
    //     }
    //     i++;
    // }

    // fclose(file);
    // fclose(boards);
    // fclose(moves);

    return 0;
}
